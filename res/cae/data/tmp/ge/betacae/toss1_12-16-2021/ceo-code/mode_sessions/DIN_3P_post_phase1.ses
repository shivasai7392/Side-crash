$
$ SESSION FOR COMPILING 3P DIN DATA
$ TEST EXAMPLE ON DIN Mid-Row 2LL | 
$------------------------------------------------------------------------------------------------------------------------------------------------------
$ -- VARIABLES
$

$------------------
$-- GENERAL info
opt var add b0 "binout*"
opt var add d0 "d3plot"
opt var add pA "${PWD}/${b0}"
opt var add pD "${PWD}/${d0}"

opt var add dat_pi_tho 3.141592653589793238462643383279502884197169399375105820974944592307816406286

opt var string follow_nodes 1,2,3

opt var add stock_dia 14
opt var add bolt_source_path "/cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/bolt_curves/"

opt var add seat_force "Seat - Force"
opt var add seat_accel "Seat - Displacement"
opt var add d3plot_data "MetaPost"
opt var add pulse_data "Pulse"

$
$ box variables are x_min,y_min,z_min,x_max,y_max,z_max
$
opt var string pulse_node 50080864

opt var string left_seat_nodes "3182082/3188375/3183880/3182981"
opt var string left_seatback_box 3150,-575,350,3500,65,875
opt var string left_seatback_pid 10720262/10720097
opt var string left_headrest_box 3375,-400,900,3450,-225,1050
opt var string left_headrest_pid 10720052/10720049/10720051/10720053

opt var string right_seat_nodes "3184779/3185678/3186577/3187476"
opt var string right_seatback_box 3150,65,350,3500,580,875
opt var string right_seatback_pid 10920020/10920046
opt var string right_headrest_box 3375,225,900,3450,400,1050
opt var string right_headrest_pid 10920121/10920123/10920124/10920125

opt var string center_seatback_box 3150,-575,350,3500,65,875
opt var string center_seatback_pid 10720262/10720097/10720286
opt var string center_headrest_box 3375,-125,875,3450,50,1000
opt var string center_headrest_pid 10720076/10720708/10720106

opt var add outer_hip_point_t 3060
opt var add center_hip_point_t 3033
$
$-- Everything here needs MORE THAN 1 INPUT
$
opt var string left_seat_sections "1-4/9"
opt var string right_seat_sections "5-8"

$------------------------------------------------------------------------------------------------------------------------------------------------------

$ -- INTIALIZING

$ -- CREATE REPORTING FOLDER
//#!python
# PYTHON script
import os

def main():
	path = os.getcwd()
	var2 = path+"/Session_Report"
	if not os.path.exists(var2):
		os.makedirs(var2)
	
if __name__ == '__main__':
	main()

//#!EOF

$------------------------------------------------------------------------------------------------------------------------------------------------------
$-- SEAT BOLT SECTION FORCES

xyplot create "${seat_force}"
window active "${seat_force}"
xyplot rlayout "${seat_force}" 17

opt var add attack_window ${seat_force}

xyplot plotactive "${seat_force}" 0
opt var add left_area_start 1
xyplot read lsdyna "${seat_force}" "${pA}" secforc-Section ${left_seat_sections} Area_(a)
opt var add left_area_end ${LAST_CURVE_ID}
xyplot curve function averof "${seat_force}" ${left_area_start}-${left_area_end}
xyplot curve fillvar left_area `w[${seat_force}]c${LAST_CURVE_ID}.y[x=0.001]`
opt var add left_area_over_pi ${left_area}/${dat_pi_tho}
opt var add left_rad sqrt(${left_area_over_pi})
opt var add left_dia ${left_rad}*2
opt var add left_scale ${left_dia}/${stock_dia}
xyplot curve delete "${seat_force}" all
xyplot plotdeactive "${seat_force}" 0

xyplot plotactive "${seat_force}" 0
opt var add right_area_start 1
xyplot read lsdyna "${seat_force}" "${pA}" secforc-Section ${right_seat_sections} Area_(a)
opt var add right_area_end ${LAST_CURVE_ID}
xyplot curve function averof "${seat_force}" ${right_area_start}-${right_area_end}
xyplot curve fillvar right_area `w[${seat_force}]c${LAST_CURVE_ID}.y[x=0.001]`
opt var add right_area_over_pi ${right_area}/${dat_pi_tho}
opt var add right_rad sqrt(${right_area_over_pi})
opt var add right_dia ${right_rad}*2
opt var add right_scale ${right_dia}/${stock_dia}
xyplot curve delete "${seat_force}" all
xyplot plotdeactive "${seat_force}" 0

xyplot plotactive "${seat_force}" 0
opt var add normal_start 1
xyplot read lsdyna "${seat_force}" "${pA}" secforc-Section ${left_seat_sections} X_force_(xf)
opt var add normal_end ${LAST_CURVE_ID}
xyplot curve set linewidth "${seat_force}" visible 0
xyplot curve visible not "${seat_force}" all
xyplot plotdeactive "${seat_force}" 0

xyplot plotactive "${seat_force}" 1
opt var add shear_comp_start ${LAST_CURVE_ID}+1
xyplot read lsdyna "${seat_force}" "${pA}" secforc-Section ${left_seat_sections} Z_force_(zf),Y_force_(yf)
opt var add shear_comp_end ${LAST_CURVE_ID}
xyplot curve set linewidth "${seat_force}" visible 0
xyplot curve visible not "${seat_force}" all
opt var add shear_start ${LAST_CURVE_ID}+1

opt var add scale ${left_scale}

//#!python
# PYTHON script
import os
import meta
import string
import fnmatch
from meta import utils
def main():
	start = utils.MetaGetVariable('shear_comp_start')
	start = float(start)
	start = int(start)
	end = utils.MetaGetVariable('shear_comp_end')
	end = float(end)
	end = int(end)
	span = int(float(end) - float(start))
	mid = float(start)+span/2
	mid = int(mid+0.5)
	r = int(float(mid) - float(start))
	r = float(r)
	r = int(r)
	for i in range(0,r):
	         s = start+i
	         s = str(s)
	         o = mid+i	 
	         o = str(o)
	         function = '`w[${seat_force}]c'+s+'.attr[name=Entity id]`'
	         name = utils.EvalBuiltInFunction(function)
	         utils.MetaSetVariable('section_name', name)
	         command ="xyplot curve function userdef"
	         command = command + ' "Section ${section_name} Resultant Shear" "c'
	         command = command + 	 s
	         command = command + 	 '.x" "sqrt(c'
	         command = command + 	s
	         command = command + 	 ".y*c"
	         command = command + 	 s
	         command = command + 	 ".y+c"
	         command = command + 	 o
	         command = command + 	 ".y*c"
	         command = command + 	 o
	         command = command + '.y)" "Seat - Force"'
	         utils.MetaCommand(command)
	
if __name__ == '__main__':
	main()
//#!EOF
opt var add shear_end ${LAST_CURVE_ID}
xyplot curve delete "${seat_force}" "${shear_comp_start}-${shear_comp_end}"
xyplot plotdeactive "${seat_force}" 1

xyplot plotactive "${seat_force}" 2
//#!python
# PYTHON script
import os
import meta
import string
import fnmatch
from meta import utils
def main():
	start = utils.MetaGetVariable('normal_start')
	start = float(start)
	start = int(start)
	end = utils.MetaGetVariable('normal_end')
	end = float(end)
	end = int(end)
	mid = utils.MetaGetVariable('shear_start')
	mid = float(mid)
	mid = int(mid)
	r = int(float(end) - float(start)+1)
	r = float(r)
	r = int(r)
	for i in range(0,r):
	         s = start+i
	         s = str(s)
	         o = mid+i	 
	         o = str(o)
	         function = '`w[${seat_force}]c'+s+'.attr[name=Entity id]`'
	         name = utils.EvalBuiltInFunction(function)
	         utils.MetaSetVariable('section_name', name)
	         command ="xyplot curve function userdef"
	         command = command + ' "Section ${section_name} Normal vs Shear" "c'
	         command = command + 	 s
	         command = command + 	 '.y" "c'
	         command = command + 	 o
	         command = command + 	 '.y" "Seat - Force"'
	         utils.MetaCommand(command)
	
if __name__ == '__main__':
	main()
//#!EOF

read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/normal_v_shear_format.ses

xyplot curve visible not "${seat_force}" all
xyplot plotdeactive "${seat_force}" 2

xyplot plotactive "${seat_force}" 3
opt var add normal_start ${LAST_CURVE_ID}+1
xyplot read lsdyna "${seat_force}" "${pA}"  secforc-Section ${right_seat_sections} X_force_(xf)
opt var add normal_end ${LAST_CURVE_ID}
xyplot curve set linewidth "${seat_force}" visible 0
xyplot curve visible not "${seat_force}" all
xyplot plotdeactive "${seat_force}" 3

xyplot plotactive "${seat_force}" 4
opt var add shear_comp_start ${LAST_CURVE_ID}+1
xyplot read lsdyna "${seat_force}" "${pA}"  secforc-Section ${right_seat_sections} Z_force_(zf),Y_force_(yf)
opt var add shear_comp_end ${LAST_CURVE_ID}
xyplot curve set linewidth "${seat_force}" visible 0
xyplot curve visible not "${seat_force}" all
opt var add shear_start ${LAST_CURVE_ID}+1

opt var add scale ${right_scale}

//#!python
# PYTHON script
import os
import meta
import string
import fnmatch
from meta import utils
def main():
	start = utils.MetaGetVariable('shear_comp_start')
	start = float(start)
	start = int(start)
	end = utils.MetaGetVariable('shear_comp_end')
	end = float(end)
	end = int(end)
	span = int(float(end) - float(start))
	mid = float(start)+span/2
	mid = int(mid+0.5)
	r = int(float(mid) - float(start))
	r = float(r)
	r = int(r)
	for i in range(0,r):
	         s = start+i
	         s = str(s)
	         o = mid+i	 
	         o = str(o)
	         function = '`w[${seat_force}]c'+s+'.attr[name=Entity id]`'
	         name = utils.EvalBuiltInFunction(function)
	         utils.MetaSetVariable('section_name', name)
	         command ="xyplot curve function userdef"
	         command = command + ' "Section ${section_name} Resultant Shear" "c'
	         command = command + 	 s
	         command = command + 	 '.x" "sqrt(c'
	         command = command + 	s
	         command = command + 	 ".y*c"
	         command = command + 	 s
	         command = command + 	 ".y+c"
	         command = command + 	 o
	         command = command + 	 ".y*c"
	         command = command + 	 o
	         command = command + '.y)" "Seat - Force"'
	         utils.MetaCommand(command)
	
if __name__ == '__main__':
	main()
//#!EOF
opt var add shear_end ${LAST_CURVE_ID}
xyplot curve delete "${seat_force}" "${shear_comp_start}-${shear_comp_end}"
xyplot plotdeactive "${seat_force}" 4

xyplot plotactive "${seat_force}" 5
//#!python
# PYTHON script
import os
import meta
import string
import fnmatch
from meta import utils
def main():
	start = utils.MetaGetVariable('normal_start')
	start = float(start)
	start = int(start)
	end = utils.MetaGetVariable('normal_end')
	end = float(end)
	end = int(end)
	mid = utils.MetaGetVariable('shear_start')
	mid = float(mid)
	mid = int(mid)
	r = int(float(end) - float(start)+1)
	r = float(r)
	r = int(r)
	for i in range(0,r):
	         s = start+i
	         s = str(s)
	         o = mid+i	 
	         o = str(o)
	         function = '`w[${seat_force}]c'+s+'.attr[name=Entity id]`'
	         name = utils.EvalBuiltInFunction(function)
	         utils.MetaSetVariable('section_name', name)
	         command ="xyplot curve function userdef"
	         command = command + ' "Section ${section_name} Normal vs Shear" "c'
	         command = command + 	 s
	         command = command + 	 '.y" "c'
	         command = command + 	 o
	         command = command + 	 '.y" "Seat - Force"'
	         utils.MetaCommand(command)
	
if __name__ == '__main__':
	main()
//#!EOF

read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/normal_v_shear_format.ses

xyplot curve visible not "${seat_force}" all
xyplot plotdeactive "${seat_force}" 5

$ -- FORMATTING

opt var add formatting_window_name "${seat_force}"

opt var add x_label "Time [ms]"
opt var add x_max 0.150
opt var add x_min 0.0
opt var add x_space 0.025
opt var add x_multiplier -3
opt var add font_info "Arial,16,-1,5,75,0,0,0,0,0"
opt var add picture_size 488x488

opt var add window_number 0
opt var add title_label "Left seat bolt normal"
opt var add y_label "Section Force [kN]"
opt var add y_max ${x_axis_max}
opt var add y_min 0
opt var add y_step 10000
opt var add y_multiplier 3
read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/2d_plot_formatting.ses

opt var add window_number 1
opt var add y_max ${y_axis_max}
opt var add title_label "Left seat bolt resultant shear"
read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/2d_plot_formatting.ses

opt var add window_number 3
opt var add y_max ${x_axis_max}
opt var add title_label "Right seat bolt normal"
read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/2d_plot_formatting.ses

opt var add window_number 4
opt var add y_max ${y_axis_max}
opt var add title_label "Right seat bolt resultant shear"
read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/2d_plot_formatting.ses

opt var add x_label "Normal Force [kN]"
opt var add x_max ${x_axis_max}
opt var add x_min 0.0
opt var add x_space 10000
opt var add x_multiplier 3
opt var add y_label "Shear Force [kN]"
opt var add y_max ${y_axis_max}
opt var add y_min 0
opt var add y_step 10000
opt var add y_multiplier 3

opt var add window_number 2
opt var add title_label "Left Seat Normal vs Shear"
read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/2d_plot_formatting.ses

opt var add window_number 5
opt var add title_label "Right Seat Normal vs Shear"
read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/2d_plot_formatting.ses

$------------------------------------------------------------------------------------------------------------------------------------------------------
$ -- SEAT BOLT DISPLACEMENT
$ 

opt var add project_path "${PWD}/"
read session "/cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/overlay_toolbar/src/02_SIDE/v1p3/search_keyfile.ses"

opt var add pG "${PWD}/${master_file}"

window active  "$(d3plot_data)"
read geom Dyna3d "${pG}"
read dis Dyna3d "${pD}" all Displacements
opt var add model ${CUR_MODEL}

xyplot create "${seat_accel}"
window active "${seat_accel}"
xyplot rlayout "${seat_accel}" 18
xyplot plotdeactive "${seat_accel}" all
window active none

$ -- CAE DATA PROCESSING
opt var add attack_window ${seat_accel}
opt var add window "${attack_window}"
opt var add window_id 0
opt var string dem_nodes ${left_seat_nodes}

read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/components_crash_nodout.ses

opt var add window_id 1
opt var add box ${left_headrest_box}
opt var string panel ${left_headrest_pid}
opt var string prefix LEFT_HEAD_REST_BOX_
opt var string hip_point_t ${outer_hip_point_t}

read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/point_cloud_box_din.ses

opt var add window_id 1
opt var add box ${left_seatback_box}
opt var string panel ${left_seatback_pid}
opt var string prefix LEFT_SEATBACK_BOX_


read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/point_cloud_box_din.ses

opt var add window_id 2
opt var string dem_nodes ${right_seat_nodes}

read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/components_crash_nodout.ses

opt var add window_id 3
opt var add box ${right_headrest_box}
opt var string panel ${right_headrest_pid}
opt var string prefix RIGHT_HEAD_REST_BOX_

read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/point_cloud_box_din.ses

opt var add window_id 3
opt var add box ${right_seatback_box}
opt var string panel ${right_seatback_pid}
opt var string prefix RIGHT_SEATBACK_BOX_

read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/point_cloud_box_din.ses

opt var add window_id 5
opt var add box ${center_headrest_box}
opt var string panel ${center_headrest_pid}
opt var string prefix CENTER_HEAD_REST_BOX_
opt var string hip_point_t ${center_hip_point_t}

read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/point_cloud_box_din.ses

opt var add window_id 5
opt var add box ${center_seatback_box}
opt var string panel ${center_seatback_pid}
opt var string prefix CENTER_SEATBACK_BOX_

read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/point_cloud_box_din.ses

opt var add formatting_window_name "${attack_window}"

opt var add x_label "Time [ms]"
opt var add x_max 0.150
opt var add x_min 0.0
opt var add x_space 0.025
opt var add x_multiplier -3
$-- Y0
opt var add y0_step 100
opt var add y0_multiplier 0
$-- Y1
opt var add y1_step 100
opt var add y1_multiplier 0
opt var add y1_label "CBU X-Coord [mm]"
$-- Y2
opt var add y2_step 50
opt var add y2_multiplier 0
opt var add y2_label "Acceleration [G]"

opt var add window_number 0
opt var add title_label "Left seat bolt nodes"
opt var add y0_label "Intrusion [mm]"
read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/2d_plot_formatting_multi_autoxy.ses

opt var add window_number 1
opt var add title_label "Left seat point boxes"
opt var add y0_label "Intrusion wrt HP [mm]"
read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/2d_plot_formatting_multi_autoxy.ses

opt var add window_number 2
opt var add title_label "Right seat bolt nodes"
opt var add y0_label "Intrusion [mm]"
read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/2d_plot_formatting_multi_autoxy.ses

opt var add window_number 3
opt var add title_label "Right seat point boxes"
opt var add y0_label "Intrusion wrt HP [mm]"
read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/2d_plot_formatting_multi_autoxy.ses

opt var add window_number 5
opt var add title_label "Center seat point boxes"
opt var add y0_label "Intrusion wrt HP [mm]"
read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/2d_plot_formatting_multi_autoxy.ses


$------------------------------------------------------------------------------------------------------------------------------------------------------
$-- PULSE DATA

xyplot create "${pulse_data}"
window active "${pulse_data}"
xyplot rlayout "${pulse_data}" 1

$ -- CAE DATA PROCESSING
opt var add attack_window ${pulse_data}
opt var add window "${attack_window}"
opt var add window_id 0
opt var string dem_nodes ${pulse_node}

read session /cae/data/reference/fr2/_DevelopmentCAE/04_Scripts/phase1_sessions/function_sessions/src/components_crash_nodout.ses

xyplot curve rfunction scale y "${attack_window}" "4" 0.0036

$------------------------------------------------------------------------------------------------------------------------------------------------------
$-- SAVE PLOT PROJECT FILE

options session controldraw enable

write options Project references 2dplot enable
write options Project typesave 2d
write options Project pagesave all
write project "label" "${PWD}/Session_Report/din_3p_phase1.metadb"

$------------------------------------------------------------------------------------------------------------------------------------------------------
$-- END